<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¾¦å…¬å®¤åœ˜è³¼~GO!GO!GO!_Body Goals å¥åº·é›¶é£Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        benq: {
                            purple: '#492083', // ä¼æ¥­ç´«
                            vivid: '#8b5cf6',  // äº®ç´«è‰²
                            light: '#f3e8ff',  
                        },
                        tech: {
                            bg: '#f8fafc',
                            slate: '#1e293b'
                        }
                    },
                    boxShadow: {
                        'neon': '0 0 15px rgba(139, 92, 246, 0.5)',
                        'card': '0 8px 32px 0 rgba(31, 38, 135, 0.07)'
                    },
                    animation: {
                        'gradient-x': 'gradient-x 3s ease infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        'gradient-x': {
                            '0%, 100%': { 'background-size': '200% 200%', 'background-position': 'left center' },
                            '50%': { 'background-size': '200% 200%', 'background-position': 'right center' },
                        },
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f1f5f9; color: #1e293b; -webkit-tap-highlight-color: transparent; }
        
        /* èƒŒæ™¯è£é£¾ */
        .bg-tech-glow {
            background-image: 
                radial-gradient(circle at 0% 0%, rgba(73, 32, 131, 0.05) 0%, transparent 60%),
                radial-gradient(circle at 100% 100%, rgba(14, 165, 233, 0.05) 0%, transparent 60%);
            background-attachment: fixed;
        }

        /* åœ–ç‰‡åˆ‡æ› */
        .img-container { position: relative; width: 100%; padding-bottom: 100%; overflow: hidden; background: #fff; }
        .img-container img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain; transition: transform 0.5s ease; mix-blend-mode: multiply; }
        .img-hover { opacity: 0; transform: scale(1.1); }
        .product-card:hover .img-hover { opacity: 1; transform: scale(1); }
        .product-card:hover .img-main { opacity: 0; }
        
        /* å¡ç‰‡è³ªæ„Ÿ */
        .product-card { 
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.02);
            transition: all 0.3s ease;
        }
        .product-card:hover { 
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05), 0 0 0 1px rgba(73, 32, 131, 0.2);
        }

        /* æŒ‰éˆ•å„ªåŒ– */
        .btn-qty { width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; user-select: none; border-radius: 10px; }
        .btn-minus { background: #f1f5f9; color: #94a3b8; }
        .btn-minus:active { background: #e2e8f0; }
        .btn-plus { background: #492083; color: white; }
        .btn-plus:active { transform: scale(0.92); }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* è‡ªå®šç¾©æ²è»¸ (çµ¦è¨‚å–®æ˜ç´°ç”¨) */
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* æµå…‰æŒ‰éˆ• */
        .btn-shiny {
            background: linear-gradient(90deg, #492083, #8b5cf6, #492083);
            background-size: 200% auto;
            animation: gradient-x 3s linear infinite;
        }
    </style>
</head>
<body class="pb-64 md:pb-48 bg-tech-glow min-h-screen">

    <div class="sticky top-0 z-40 bg-white/90 backdrop-blur-xl border-b border-slate-200/60 shadow-sm transition-all duration-300">
        <div class="max-w-6xl mx-auto px-4 py-4">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div>
                    <h1 class="text-xl md:text-2xl font-bold text-slate-800 flex items-center gap-2 tracking-tight">
                        <span class="bg-benq-purple text-white p-1.5 rounded-lg shadow-md">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                            </svg>
                        </span>
                        è¾¦å…¬å®¤åœ˜è³¼~GO!GO!GO!
                    </h1>
                    <div class="mt-2 flex items-center gap-3 text-sm ml-1 md:ml-12">
                        <span class="inline-flex items-center gap-1.5 bg-red-50 text-red-600 px-3 py-1 rounded-full text-xs font-bold border border-red-100">
                            <span class="relative flex h-2 w-2">
                              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                              <span class="relative inline-flex rounded-full h-2 w-2 bg-red-500"></span>
                            </span>
                            æˆªæ­¢ï¼š2025/12/21 (æ—¥) 12:00
                        </span>
                        <span id="countdown-timer" class="text-benq-purple font-mono font-bold tracking-tight">è¨ˆç®—ä¸­...</span>
                    </div>
                </div>
                
                <a href="https://www.bodygoals.com.tw/categories/healthy-snacks" target="_blank" 
                   class="group relative overflow-hidden rounded-xl p-[2px] shadow-neon transition-all hover:-translate-y-1 hover:shadow-lg">
                    <div class="absolute inset-0 btn-shiny opacity-80"></div>
                    <div class="relative bg-white rounded-[10px] px-5 py-3 flex items-center justify-center gap-2 transition-all group-hover:bg-opacity-90">
                        <span class="text-sm font-bold text-benq-purple group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-benq-purple group-hover:to-benq-vivid">
                            å‰å¾€ Body Goals å®˜ç¶²æŸ¥çœ‹å•†å“è©³æƒ…
                        </span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-benq-purple transition-transform group-hover:translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                        </svg>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <div class="max-w-6xl mx-auto px-4 mt-6">
        <div class="bg-white/70 backdrop-blur-md rounded-2xl border border-white shadow-sm p-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-sm font-bold text-slate-600 flex items-center gap-2 uppercase tracking-wider">
                    <span class="w-2.5 h-2.5 rounded-full bg-emerald-400 shadow-[0_0_8px_rgba(52,211,153,0.8)]"></span>
                    ç›®å‰è¨‚å–®
                </h2>
                <button onclick="fetchOrders()" class="text-xs text-benq-purple font-medium hover:underline flex items-center gap-1 bg-benq-light px-2 py-1 rounded transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
                    åˆ·æ–°è³‡æ–™
                </button>
            </div>
            <div class="flex gap-4 overflow-x-auto no-scrollbar pb-2 items-start" id="order-log-cards">
                <div class="flex-none w-full text-center text-slate-400 text-sm py-2">è¼‰å…¥ä¸­...</div>
            </div>
            <div class="mt-2 text-right text-xs text-slate-400 font-medium">
                ç›®å‰å…± <span id="stat-count" class="font-bold text-benq-purple text-base">0</span> äººåƒèˆ‡
            </div>
        </div>
    </div>

    <div class="max-w-6xl mx-auto p-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6" id="product-list"></div>

    <div class="fixed bottom-0 left-0 w-full z-50 px-0 md:px-4 md:bottom-6 pointer-events-none pb-[env(safe-area-inset-bottom)]">
        <div class="max-w-3xl mx-auto bg-white/95 md:rounded-2xl border-t md:border border-slate-200 shadow-[0_-10px_40px_-15px_rgba(0,0,0,0.15)] p-4 pointer-events-auto backdrop-blur-xl transition-all transform md:hover:scale-[1.01]">
            <div class="flex justify-between items-center mb-3 text-sm px-1">
                <div class="text-slate-500 font-medium">å·²é¸ <span id="total-count" class="text-slate-900 font-bold text-lg">0</span> é …</div>
                <div class="text-benq-purple font-bold text-base" id="footer-range-total">é ä¼° $0</div>
            </div>
            <div class="flex flex-col md:flex-row gap-3">
                <div class="w-full relative group">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="h-5 w-5 text-slate-400 group-focus-within:text-benq-purple transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                    </div>
                    <input type="text" id="buyer-name" placeholder="è«‹è¼¸å…¥å§“å (åŒåå°‡è‡ªå‹•è¦†è“‹èˆŠå–®)" 
                        class="w-full pl-10 pr-4 py-3.5 bg-slate-50 border border-slate-200 text-slate-800 text-base rounded-xl focus:ring-2 focus:ring-benq-purple/50 focus:border-benq-purple outline-none transition shadow-inner">
                </div>
                <button onclick="reviewOrder()" id="submit-btn"
                    class="w-full md:w-auto md:px-10 py-3.5 bg-gradient-to-r from-benq-purple to-[#6d28d9] hover:to-benq-purple text-white font-bold text-base rounded-xl shadow-lg shadow-benq-purple/30 active:scale-[0.98] transition-all flex justify-center items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                    é€å‡ºè¨‚å–®
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 1.414L10.586 9H7a1 1 0 100 2h3.586l-1.293 1.293a1 1 0 101.414 1.414l3-3a1 1 0 000-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
            <div class="text-[11px] text-slate-500 mt-2.5 text-center flex justify-center items-center gap-1.5 bg-slate-50 py-1.5 rounded-lg border border-slate-100">
                <svg class="w-3.5 h-3.5 text-amber-500 flex-none" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                <span class="leading-tight text-left md:text-center"><b>åŒåè¦†è“‹æ¨¡å¼ï¼š</b>è‹¥éœ€ä¿®æ”¹è¨‚å–®ï¼Œè¼¸å…¥<b>ã€Œå®Œå…¨ç›¸åŒçš„å§“åã€</b>é€å‡ºï¼Œç³»çµ±å°‡è‡ªå‹•ä»¥æ–°è¨‚å–®å–ä»£èˆŠè³‡æ–™ã€‚</span>
            </div>
        </div>
    </div>

    <div id="confirm-modal" class="fixed inset-0 z-[60] hidden">
        <div class="absolute inset-0 bg-slate-900/50 backdrop-blur-sm transition-opacity opacity-0" id="modal-backdrop"></div>
        <div class="absolute inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm transform scale-95 opacity-0 transition-all duration-300" id="modal-content">
                <div class="p-6">
                    <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <span class="w-8 h-8 rounded-full bg-benq-light text-benq-purple flex items-center justify-center shadow-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        </span>
                        è¨‚å–®ç¢ºèª
                    </h3>
                    <div class="bg-slate-50/80 rounded-xl p-4 mb-4 border border-slate-100">
                        <div class="flex justify-between mb-2">
                            <div class="text-xs text-slate-400 font-bold uppercase tracking-wider">è¨‚è³¼äºº</div>
                            <div class="text-base font-bold text-benq-purple tracking-tight" id="modal-name">User</div>
                        </div>
                        <div class="border-t border-slate-200 my-2"></div>
                        <div class="space-y-2 max-h-40 overflow-y-auto custom-scrollbar text-sm text-slate-700" id="modal-items"></div>
                        <div class="border-t border-slate-200 my-3"></div>
                        <div class="flex justify-between items-center">
                            <span class="text-xs font-bold text-slate-500 uppercase">ç¸½é‡‘é¡</span>
                            <span class="text-xl font-bold text-slate-800 font-mono" id="modal-total">$0</span>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="closeModal()" class="py-3.5 rounded-xl border border-slate-200 text-slate-600 font-bold hover:bg-slate-50 transition active:scale-95">è¿”å›ä¿®æ”¹</button>
                        <button onclick="finalSubmit()" id="final-submit-btn" class="py-3.5 rounded-xl bg-benq-purple text-white font-bold shadow-lg shadow-benq-purple/30 hover:bg-[#3b1a6b] transition active:scale-95">ç¢ºèªé€å‡º</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const DEADLINE = new Date('2025-12-21T12:00:00'); 
        const products = [
            { id: 'chips_mexican', name: 'é«˜è›‹ç™½è„†ç‰‡-å¢¨è¥¿å“¥ç´…æ¤’', minPrice: 38.25, maxPrice: 42, img1: 'https://shoplineimg.com/5ea6673cf58d53001a5e49d8/688ac6bf7d2332000a02666c/540x.webp?source_format=jpg', img2: 'https://shoplineimg.com/5ea6673cf58d53001a5e49d8/6822b6263d6d1c000bee4160/540x.webp?source_format=jpg' },
            { id: 'chips_onion', name: 'é«˜è›‹ç™½è„†ç‰‡-é…¸å¥¶æ´‹è”¥', minPrice: 38.25, maxPrice: 42, img1: 'https://shoplineimg.com/5ea6673cf58d53001a5e49d8/688ac6a55fcec900144b7122/540x.webp?source_format=jpg', img2: 'https://shoplineimg.com/5ea6673cf58d53001a5e49d8/6822b609fae050000e1923a3/540x.webp?source_format=jpg' },
            { id: 'chips_cheese', name: 'é«˜è›‹ç™½è„†ç‰‡-å¥¶é¦™èµ·å¸', minPrice: 38.25, maxPrice: 42, img1: 'https://shoplineimg.com/5ea6673cf58d53001a5e49d8/688ac69260992437228175da/540x.webp?source_format=jpg', img2: 'https://shoplineimg.com/5ea6673cf58d53001a5e49d8/6822b594ee5413000b30d744/540x.webp?source_format=jpg' },
            { id: 'chips_pizza', name: 'é«˜è›‹ç™½è„†ç‰‡-ç¾©å¼æŠ«è–©', minPrice: 38.25, maxPrice: 42, img1: 'https://shoplineimg.com/5ea6673cf58d53001a5e49d8/688ac6b2c5b9a60014a7e903/540x.webp?source_format=jpg', img2: 'https://shoplineimg.com/5ea6673cf58d53001a5e49d8/6822b5e027dc25000da88c5e/540x.webp?source_format=jpg' },
            { id: 'bar_caramel', name: 'èƒ½é‡è›‹ç™½æ£’-å¤ªå¦ƒæµ·é¹½ç„¦ç³–', minPrice: 48, maxPrice: 48.5, img1: 'https://shoplineimg.com/5ea6673cf58d53001a5e49d8/688c21981c2690000eb91d0b/540x.webp?source_format=jpg', img2: 'https://shoplineimg.com/5ea6673cf58d53001a5e49d8/68537c8913f22f000ba07fb6/540x.webp?source_format=jpg' },
            { id: 'bar_tiramisu', name: 'èƒ½é‡è›‹ç™½æ£’-ææ‹‰ç±³è˜‡', minPrice: 48, maxPrice: 48.5, img1: 'https://shoplineimg.com/5ea6673cf58d53001a5e49d8/688c21610a230f000eceaa77/540x.webp?source_format=jpg', img2: 'https://shoplineimg.com/5ea6673cf58d53001a5e49d8/68538c209dc17b000c5f9cdb/540x.webp?source_format=jpg' },
            { id: 'bar_white', name: 'èƒ½é‡è›‹ç™½æ£’-æˆ€è“ç™½å·§å…‹åŠ›', minPrice: 48, maxPrice: 48.5, img1: 'https://shoplineimg.com/5ea6673cf58d53001a5e49d8/688ac492dd451a000cf4223a/540x.webp?source_format=jpg', img2: 'https://shoplineimg.com/5ea6673cf58d53001a5e49d8/66f3c063b7ffeb000c17bc73/540x.webp?source_format=png' },
            { id: 'bar_peanut', name: 'èƒ½é‡è›‹ç™½æ£’-æ¿ƒåšå¥¶æ²¹èŠ±ç”Ÿ', minPrice: 48, maxPrice: 48.5, img1: 'https://shoplineimg.com/5ea6673cf58d53001a5e49d8/688c218bcac261000edd1a37/540x.webp?source_format=jpg', img2: 'https://shoplineimg.com/5ea6673cf58d53001a5e49d8/68537b5efaf50f000f074809/540x.webp?source_format=jpg' },
            { id: 'jelly_original', name: 'ZEROç¾é¡è† åŸå‡ (åŸå‘³)', minPrice: 45, maxPrice: 48, img1: 'https://shoplineimg.com/5ea6673cf58d53001a5e49d8/68f20ed9ca6a1f000a48d0c0/540x.webp?source_format=jpg', img2: 'https://shoplineimg.com/5ea6673cf58d53001a5e49d8/68f588a023fc060014fd870d/540x.webp?source_format=jpg' }
        ];

        // ğŸ”¥ğŸ”¥ğŸ”¥ è¨˜å¾—æŠŠé€™è£¡çš„ç¶²å€ï¼Œæ›æˆæ‚¨å‰›å‰›éƒ¨ç½²å¥½çš„ã€Œæ–°ã€ç¶²å€å–”ï¼ ğŸ”¥ğŸ”¥ğŸ”¥
        const scriptURL = 'https://script.google.com/macros/s/AKfycbzcn4Q-H6k8T3EuIzmoiZHnbF9-0jYh5eWu-dLBJ3IS1zPO27WDUUwBjP2xsDWzlMEzUA/exec';

        const cart = {};
        let currentPayload = null;
        let isExpired = false;
        
        let deviceUUID = localStorage.getItem('bg_order_uuid');
        if (!deviceUUID) {
            deviceUUID = 'user-' + Date.now() + '-' + Math.floor(Math.random() * 10000);
            localStorage.setItem('bg_order_uuid', deviceUUID);
        }
        
        const lastBuyerName = localStorage.getItem('bg_buyer_name');

        function init() {
            if(lastBuyerName) document.getElementById('buyer-name').value = lastBuyerName;
            const container = document.getElementById('product-list');
            products.forEach(p => {
                cart[p.id] = 0;
                const card = `
                    <div class="product-card rounded-2xl overflow-hidden group flex flex-col h-full">
                        <div class="img-container">
                            <img src="${p.img1}" class="img-main" loading="lazy">
                            <img src="${p.img2}" class="img-hover" loading="lazy">
                        </div>
                        <div class="p-4 flex-1 flex flex-col">
                            <h3 class="font-bold text-slate-700 text-sm leading-snug mb-3 flex-1">${p.name}</h3>
                            <div class="flex justify-between items-end mb-3">
                                <div class="text-[10px] text-slate-400 bg-slate-100 px-2 py-0.5 rounded">é ä¼°åƒ¹</div>
                                <div class="text-right">
                                    <span class="text-benq-purple font-bold text-base font-mono">$${p.minPrice}</span>
                                    <span class="text-slate-400 text-[10px]"> ~ $${p.maxPrice}</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between bg-slate-50 p-1 rounded-xl">
                                <div class="btn-qty btn-minus" onclick="updateQty('${p.id}', -1)">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/></svg>
                                </div>
                                <span class="font-bold text-lg w-8 text-center text-slate-700 font-mono" id="qty-${p.id}">0</span>
                                <div class="btn-qty btn-plus" onclick="updateQty('${p.id}', 1)">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += card;
            });
            fetchOrders();
            setInterval(fetchOrders, 15000); 
            updateCountdown();
            setInterval(updateCountdown, 1000);
        }

        function updateCountdown() {
            const now = new Date();
            const diff = DEADLINE - now;
            const timerElement = document.getElementById('countdown-timer');
            const submitBtn = document.getElementById('submit-btn');
            if (diff <= 0) {
                isExpired = true;
                timerElement.innerText = "å·²æˆªæ­¢";
                timerElement.classList.add('text-red-500');
                submitBtn.disabled = true;
                submitBtn.innerHTML = "ğŸš« å·²æˆªæ­¢";
                submitBtn.classList.add('bg-slate-400', 'cursor-not-allowed');
                submitBtn.classList.remove('bg-benq-purple', 'shadow-lg');
                return;
            }
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            timerElement.innerText = `${days}å¤© ${hours}æ™‚ ${minutes}åˆ†`;
        }

        function updateQty(id, change) {
            if (isExpired) { alert('æŠ±æ­‰ï¼Œåœ˜è³¼å·²æˆªæ­¢ï¼'); return; }
            if (cart[id] + change < 0) return;
            cart[id] += change;
            document.getElementById(`qty-${id}`).innerText = cart[id];
            calculateTotal();
        }

        function calculateTotal() {
            let minTotal = 0;
            let maxTotal = 0;
            let count = 0;
            products.forEach(p => {
                const qty = cart[p.id];
                if (qty > 0) {
                    minTotal += qty * p.minPrice;
                    maxTotal += qty * p.maxPrice;
                    count += qty;
                }
            });
            const rangeText = `$${Math.round(minTotal).toLocaleString()} ~ $${Math.round(maxTotal).toLocaleString()}`;
            
            document.getElementById('footer-range-total').innerText = rangeText;
            document.getElementById('total-count').innerText = count;
        }

        // ğŸ”¥ é‡é»ä¿®æ”¹å€ï¼šæŠŠè¨‚å–®å¡ç‰‡è®Šå¤§ã€é¡¯ç¤ºå®Œæ•´è³‡è¨Š ğŸ”¥
        function fetchOrders() {
            const logContainer = document.getElementById('order-log-cards');
            fetch(scriptURL + '?t=' + new Date().getTime())
                .then(res => res.json())
                .then(data => {
                    if (data.length === 0) {
                        logContainer.innerHTML = '<div class="w-full text-center text-slate-400 text-xs py-2">ç›®å‰å°šç„¡è¨‚å–®</div>';
                        document.getElementById('stat-count').innerText = '0';
                        return;
                    }
                    const recentData = [...data].reverse().slice(0, 15);
                    let html = '';
                    recentData.forEach(order => {
                        let timeStr = '';
                        if(order.time) {
                            const d = new Date(order.time);
                            timeStr = `${d.getMonth()+1}/${d.getDate()} ${d.getHours()}:${d.getMinutes().toString().padStart(2, '0')}`;
                        }
                        
                        // 1. æŠŠæ›è¡Œç¬¦è™Ÿ (\n) è½‰æˆ HTML çš„æ›è¡Œ (<br>)
                        const itemsFull = order.items.replace(/\n/g, '<br>');
                        
                        // 2. æ–°çš„å¡ç‰‡ HTML çµæ§‹ï¼šè®Šå¯¬(w-56)ã€é¡¯ç¤ºç¸½é‡‘é¡ã€é¡¯ç¤ºå®Œæ•´å…§å®¹(å¯æ²å‹•)
                        html += `
                            <div class="flex-none w-56 bg-white p-3 rounded-xl border border-slate-100 shadow-sm flex flex-col gap-2">
                                <div class="flex justify-between items-start border-b border-slate-100 pb-2">
                                    <div class="flex items-center gap-1.5 overflow-hidden">
                                        <div class="flex-none w-6 h-6 rounded-full bg-benq-light text-benq-purple text-xs font-bold flex items-center justify-center">
                                            ${order.name.charAt(0).toUpperCase()}
                                        </div>
                                        <div class="text-xs font-bold text-slate-700 truncate">${order.name}</div>
                                    </div>
                                    <div class="text-xs font-bold text-benq-purple whitespace-nowrap">${order.total}</div>
                                </div>

                                <div class="text-[11px] text-slate-500 leading-tight h-20 overflow-y-auto custom-scrollbar">
                                    ${itemsFull}
                                </div>

                                <div class="text-[10px] text-slate-300 mt-auto text-right pt-1 border-t border-slate-50">
                                    ${timeStr}
                                </div>
                            </div>
                        `;
                    });
                    logContainer.innerHTML = html;
                    document.getElementById('stat-count').innerText = data.length;
                })
                .catch(err => { console.error('è®€å–å¤±æ•—', err); });
        }

        function reviewOrder() {
            if (isExpired) { alert('åœ˜è³¼å·²æˆªæ­¢ï¼'); return; }
            const nameInput = document.getElementById('buyer-name');
            const name = nameInput.value.trim();
            if (!name) { alert('è«‹è¼¸å…¥æ‚¨çš„å§“å'); nameInput.focus(); return; }
            let orderItemsHTML = '';
            let hasItem = false;
            let orderDetailsForAPI = [];
            products.forEach(p => {
                const qty = cart[p.id];
                if (qty > 0) {
                    orderItemsHTML += `
                        <div class="flex justify-between items-center py-2 border-b border-dashed border-slate-100 last:border-0 text-sm">
                            <span class="text-slate-600">${p.name}</span>
                            <span class="font-bold text-slate-800 bg-slate-100 px-2 py-0.5 rounded">x ${qty}</span>
                        </div>`;
                    orderDetailsForAPI.push(`${p.name} x ${qty}`);
                    hasItem = true;
                }
            });
            if (!hasItem) { alert('è«‹è‡³å°‘é¸æ“‡ä¸€é …å•†å“'); return; }
            currentPayload = {
                name: name,
                uid: deviceUUID, 
                uuid: deviceUUID, 
                order: orderDetailsForAPI.join('\n'), 
                total: document.getElementById('footer-range-total').innerText
            };
            document.getElementById('modal-name').innerText = name;
            document.getElementById('modal-items').innerHTML = orderItemsHTML;
            document.getElementById('modal-total').innerText = currentPayload.total;
            const modal = document.getElementById('confirm-modal');
            const backdrop = document.getElementById('modal-backdrop');
            const content = document.getElementById('modal-content');
            modal.classList.remove('hidden');
            setTimeout(() => {
                backdrop.classList.remove('opacity-0');
                content.classList.remove('opacity-0', 'scale-95');
                content.classList.add('opacity-100', 'scale-100');
            }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('confirm-modal');
            const backdrop = document.getElementById('modal-backdrop');
            const content = document.getElementById('modal-content');
            backdrop.classList.add('opacity-0');
            content.classList.remove('opacity-100', 'scale-100');
            content.classList.add('opacity-0', 'scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        // ğŸ”¥ æ›´æ–°å¾Œçš„é€å‡ºé‚è¼¯ï¼šåŒåè¦†è“‹ç¢ºèª ğŸ”¥
        function finalSubmit() {
            const submitBtn = document.getElementById('final-submit-btn');
            submitBtn.disabled = true;
            submitBtn.innerText = 'è™•ç†ä¸­...';
            
            localStorage.setItem('bg_buyer_name', currentPayload.name);

            const logContainer = document.getElementById('order-log-cards');
            if(logContainer.innerHTML.includes('å°šç„¡è¨‚å–®') || logContainer.innerText.includes('è¼‰å…¥ä¸­')) {
                logContainer.innerHTML = '';
            }
            
            // æ’å…¥å‡å¡ç‰‡è®“ä½¿ç”¨è€…çŸ¥é“æœ‰åæ‡‰
            const tempHTML = `
                <div id="temp-card" class="flex-none w-56 bg-purple-50 p-3 rounded-xl border border-benq-purple/30 animate-pulse flex flex-col gap-1">
                    <div class="flex items-center gap-2">
                        <div class="w-6 h-6 rounded-full bg-benq-purple text-white text-xs font-bold flex items-center justify-center">
                            ${currentPayload.name.charAt(0).toUpperCase()}
                        </div>
                        <div class="text-xs font-bold text-slate-800 truncate">${currentPayload.name}</div>
                    </div>
                    <div class="text-[10px] text-benq-purple">è³‡æ–™å‚³è¼¸ä¸­...</div>
                </div>
            `;
            logContainer.insertAdjacentHTML('afterbegin', tempHTML);

            // é€å‡ºè³‡æ–™
            fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify(currentPayload)
            }).then(() => {
                console.log("è«‹æ±‚å·²é€å‡ºï¼Œæ­£åœ¨é©—è­‰...");
                setTimeout(() => {
                    fetch(scriptURL + '?t=' + new Date().getTime())
                        .then(res => res.json())
                        .then(data => {
                            const myOrder = data.find(r => r.name === currentPayload.name);
                            const tempCard = document.getElementById('temp-card');
                            if(tempCard) tempCard.remove();

                            if (myOrder) {
                                alert(`\nè¨‚å–®é€å‡ºæˆåŠŸï¼\n\næ­¡è¿æ‚¨ä¸€èµ·ã€Œæ±‚æ–°æ±‚è®Šï¼Œå…±å‰µæœªä¾†ï¼ã€`);
                                location.reload();
                            } else {
                                // å› ç‚ºå¾Œç«¯å·²ç¶“å–æ¶ˆäº†åå­—æª¢æŸ¥ï¼Œæ‰€ä»¥å¦‚æœé€™è£¡æ²’æ‰¾åˆ°è¨‚å–®ï¼Œé€šå¸¸æ˜¯ç¶²è·¯å»¶é²æˆ–è©¦ç®—è¡¨å¯«å…¥å¤ªæ…¢
                                alert('âš ï¸ ç³»çµ±å›æ‡‰è¼ƒæ…¢ï¼Œè«‹æ‰‹å‹•åˆ·æ–°é é¢ç¢ºèªã€‚\n\nè‹¥ã€Œç›®å‰è¨‚å–®ã€ä¸­å·²æœ‰æ‚¨çš„åå­—ï¼Œä»£è¡¨å·²æˆåŠŸï¼›è‹¥ç„¡ï¼Œè«‹å†é€å‡ºä¸€æ¬¡ã€‚');
                                
                                submitBtn.disabled = false;
                                submitBtn.innerText = 'ç¢ºèªé€å‡º';
                                closeModal();
                                fetchOrders(); 
                            }
                        });
                }, 1500); 
            }).catch(error => {
                console.error('Error:', error);
                alert('ç¶²è·¯é€£ç·šéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²è·¯å¾Œé‡è©¦ã€‚');
                const tempCard = document.getElementById('temp-card');
                if(tempCard) tempCard.remove();
                
                submitBtn.disabled = false;
                submitBtn.innerText = 'ç¢ºèªé€å‡º';
                closeModal();
            });
        }

        init();
    </script>
</body>
</html>
